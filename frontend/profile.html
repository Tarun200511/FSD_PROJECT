<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - WishVipe</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">WishVipe</a>
            <ul class="nav-links">
                <li><a href="cart.html">Cart</a></li>
                <li id="auth-links"></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <h2 style="margin: 30px 0;">My Profile</h2>
        <div style="display: flex; gap: 50px;">
            <div style="flex: 1;">
                <h3>User Info</h3>
                <p><strong>Name:</strong> <span id="profile-name"></span></p>
                <p><strong>Email:</strong> <span id="profile-email"></span></p>
            </div>
            <div style="flex: 2;">
                <h3>My Orders</h3>
                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <thead>
                        <tr style="background: #eee; text-align: left;">
                            <th style="padding: 10px;">ID</th>
                            <th style="padding: 10px;">Date</th>
                            <th style="padding: 10px;">Total</th>
                            <th style="padding: 10px;">Paid</th>
                            <th style="padding: 10px;">Delivered</th>
                        </tr>
                    </thead>
                    <tbody id="order-list">
                        <!-- Orders will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script>
        const loadProfile = async () => {
            const userInfo = JSON.parse(localStorage.getItem('userInfo'));
            if (!userInfo) {
                window.location.href = 'login.html';
                return;
            }

            document.getElementById('profile-name').innerText = userInfo.name;
            document.getElementById('profile-email').innerText = userInfo.email;

            try {
                const response = await fetch('http://localhost:5000/api/orders/myorders', {
                    headers: {
                        'Authorization': `Bearer ${userInfo.token}`
                    }
                });
                const orders = await response.json();

                const orderList = document.getElementById('order-list');
                orderList.innerHTML = orders.map(order => `
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 10px;">${order._id}</td>
                        <td style="padding: 10px;">${order.createdAt.substring(0, 10)}</td>
                        <td style="padding: 10px;">$${order.totalPrice}</td>
                        <td style="padding: 10px;">${order.isPaid ? 'Yes' : 'No'}</td>
                        <td style="padding: 10px;">${order.isDelivered ? 'Yes' : 'No'}</td>
                    </tr>
                `).join('');

            } catch (error) {
                console.error(error);
            }
        };

        document.addEventListener('DOMContentLoaded', loadProfile);
    </script>
</body>

</html>